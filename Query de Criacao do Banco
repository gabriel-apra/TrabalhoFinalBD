
create database tfbd;
use tfdb;
create table USUARIOS (
    CPF_USR int not null primary key
    check (CPF_USR < 999999999),
    CPF_DV int not null
    check (CPF_DV<100),
    NOM_USR VARCHAR (250) not null,
    EMAIL_USR varchar (300) not null,
    MATRICULA_USR varchar (15) not null,
    SENHA_USR varchar (20) not null,
    ADMINISTRADOR BIT DEFAULT 0 NOT NULL
)

CREATE TABLE DEPARTAMENTOS (
    IND_DEPARTAMENTO INT IDENTITY (1,1) primary key,
    COD_DEPARTAMENTO VARCHAR (100) NOT NULL,
    NOM_DEPARTAMENTO VARCHAR (200) NOT NULL,
    ATIVO BIT DEFAULT 1 NOT NULL
)
CREATE TABLE CURSOS (
    IND_CURSO INT IDENTITY (1,1) primary key,
    IND_DEPARTAMENTO INT FOREIGN KEY REFERENCES DEPARTAMENTOS (IND_DEPARTAMENTO) not NULL,
    NOM_CURSO VARCHAR (200) NOT NULL,
    ATIVO BIT NOT NULL DEFAULT 1 
)

CREATE TABLE ESTUDANTES (
    IND_ESTUDANTE INT IDENTITY(1,1) PRIMARY KEY,
    CPF_ESTUDANTE INT FOREIGN KEY REFERENCES USUARIOS(CPF_USR) NOT NULL,
    IND_CURSO INT FOREIGN KEY REFERENCES CURSOS (IND_CURSO) NOT NULL,
    ATIVO BIT DEFAULT 1 NOT NULL
)

CREATE TABLE PROFESSORES (
    IND_PROFESSOR INT IDENTITY(1,1) PRIMARY KEY,
    CPF_PROFESSOR INT FOREIGN KEY REFERENCES USUARIOS (CPF_USR) NOT NULL,
    IND_DEPARTAMENTO INT FOREIGN KEY REFERENCES DEPARTAMENTOS (IND_DEPARTAMENTO) NOT NULL,
    ATIVO BIT DEFAULT 1 NOT NULL
)

CREATE TABLE TURMAS (
    IND_TURMA INT IDENTITY (1,1) PRIMARY KEY,
    COD_TURMA VARCHAR (100) NOT NULL,
    TURMA VARCHAR (2) NOT NULL,
    IND_DEPARTAMENTO INT FOREIGN KEY REFERENCES DEPARTAMENTOS (IND_DEPARTAMENTO) NOT NULL,
    IND_PROFESSOR INT FOREIGN KEY REFERENCES PROFESSORES (IND_PROFESSOR) NOT NULL
    )

CREATE TABLE AVALIACOES (
    IND_AVALIACAO INT IDENTITY(1,1) PRIMARY KEY,
    IND_ESTUDANTE INT FOREIGN KEY REFERENCES ESTUDANTES(IND_ESTUDANTE) NOT NULL,
    IND_PROFESSOR INT FOREIGN KEY REFERENCES PROFESSORES(IND_PROFESSOR) NOT NULL,
    IND_DEPARTAMENTO INT FOREIGN KEY REFERENCES DEPARTAMENTOS(IND_DEPARTAMENTO) NOT NULL,
    VAL_AVALIACAO INT,
    CHECK (VAL_AVALIACAO<=5),
    DES_AVALIACAO VARCHAR (500),
    ATIVO BIT NOT NULL DEFAULT 1
)


CREATE TABLE DENUNCIAS (
    IND_DENUNCIA INT IDENTITY(1,1) PRIMARY KEY,
    IND_AVALIACAO INT FOREIGN KEY REFERENCES AVALIACOES (IND_AVALIACAO),
    PROCEDE BIT DEFAULT NULL,
    IND_AVALIADOR INT FOREIGN KEY REFERENCES USUARIOS (CPF_USR),
    ATIVO BIT NOT NULL DEFAULT 1
)
